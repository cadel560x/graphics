<!DOCTYPE html>
<html>
    <head>
        <title>Graphics Project</title>
        <meta charset="UTF-8">
        <style type="text/css"></style>
    </head>
    <body>
        <canvas id="gamecanvas"></canvas>
        <script type="text/javascript">          
            // Create the canvas
            var canvas = document.getElementById("gamecanvas");
		    var ctx = canvas.getContext("2d");

            // Initialize the canvas
            function init() {
			    canvas.width = 512;
                canvas.height = 480;
			    canvas.style.border = "solid 1px black";
		    }

            // Background image
            var bgReady = false;
            var bgImage = new Image();
            bgImage.onload = function () {
                bgReady = true;
            };
            bgImage.src = "images/background.png";

            // Hero image
            var heroReady = false;
            var heroImage = new Image();
            heroImage.onload = function () {
                heroReady = true;
            };
            heroImage.src = "images/hero.png";

            // Monster image
            var monsterReady = false;
            var monsterImage = new Image();
            monsterImage.onload = function () {
                monsterReady = true;
            };
            monsterImage.src = "images/monster.png";

            // Game objects
            var hero = {
                speed: 256 // movement in pixels per second
            };

            // var monster = {
            //     speed: 64 // movement in pixels per second
            // };
            var monstersCaught = 0;
            var monsters = []; // An array of monsters

            // Handle keyboard controls
            var keysDown = {};

            addEventListener("keydown", function (e) {
                keysDown[e.keyCode] = true;
            }, false);

            addEventListener("keyup", function (e) {
                delete keysDown[e.keyCode];
            }, false);

            // Reset the game when the player catches a monster
            var reset = function () {
                hero.x = canvas.width / 2;
                hero.y = canvas.height / 2;

                for (i = 0; i < 3; i++) {
                    // Throw the monsters somewhere on the screen randomly
                    monsters.push({
                        x:  32 + (Math.random() * (canvas.width - 64)),
                        y:  32 + (Math.random() * (canvas.width - 64)),
                        speed: 64
                    });
                }
            };

            // Update game objects
            var update = function (modifier) {
                if (38 in keysDown) { // Player holding up
                    hero.y -= hero.speed * modifier;
                }
                if (40 in keysDown) { // Player holding down
                    hero.y += hero.speed * modifier;
                }
                if (37 in keysDown) { // Player holding left
                    hero.x -= hero.speed * modifier;
                }
                if (39 in keysDown) { // Player holding right
                    hero.x += hero.speed * modifier;
                }

                for(i = 0; i < monsters.length; i++) {
                // Collision detection
                    if (
                        hero.x <= (monsters[i].x + 32)
                        && monsters[i].x <= (hero.x + 32)
                        && hero.y <= (monsters[i].y + 32)
                        && monsters[i].y <= (hero.y + 32)
                        ) {
                          ++monstersCaught;
                          delete monsters[i];
                        }
                    if ( monsters.length == 0 ) {
                        reset();
                    }
                }
            };

            // Draw everything
            var render = function () {
                if (bgReady) {
                    ctx.drawImage(bgImage, 0, 0);
                }

                if (heroReady) {
                    ctx.drawImage(heroImage, hero.x, hero.y);
                }

                if (monsterReady) {
                    for (i = 0; i < monsters.length; i++) {
                        ctx.drawImage(monsterImage, monsters[i].x, monsters[i].y);
                    }
                }

                // Score
                ctx.fillStyle = "rgb(250, 250, 250)";
                ctx.font = "24px Helvetica";
                ctx.textAlign = "left";
                ctx.textBaseline = "top";
                ctx.fillText("Goblins caught: " + monstersCaught, 32, 32);
            };

            // The main game loop
            var main = function () {
                var now = Date.now();
                var delta = now - then;

                update(delta / 1000);
                render();

                then = now;

                // Request to do this again ASAP
                requestAnimationFrame(main);
            };


            // Let's play this game!
            var then = Date.now();
            init();
            reset();
            main();
        </script>
    </body>
</html>